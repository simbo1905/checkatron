-- Example stack of SnowSQL steps (one statement per line)
CREATE OR REPLACE TABLE before_table(ACCOUNT_ID NUMBER, PORTFOLIO_NAME VARCHAR(50), VALUATION_DATE DATE, BALANCE NUMBER(15,2), STATUS VARCHAR(20));
CREATE OR REPLACE TABLE after_table(ACCOUNT_ID NUMBER, PORTFOLIO_NAME VARCHAR(50), VALUATION_DATE DATE, BALANCE NUMBER(15,2), STATUS VARCHAR(20), NEW_COLUMN NUMBER(10,2));
INSERT INTO before_table VALUES (1001,'PORTFOLIO_A','2024-01-01',10000.00,'ACTIVE'),(1002,'PORTFOLIO_B','2024-01-01',25000.50,'ACTIVE'),(1003,'PORTFOLIO_A','2024-01-01',5000.75,'SUSPENDED'),(1004,'PORTFOLIO_C','2024-01-01',15000.25,'ACTIVE'),(1005,'PORTFOLIO_B','2024-01-01',30000.00,'ACTIVE');
INSERT INTO after_table VALUES (1001,'PORTFOLIO_A','2024-01-01',10000.00,'ACTIVE',100.00),(1002,'PORTFOLIO_B','2024-01-01',25000.50,'ACTIVE',200.00),(1003,'PORTFOLIO_A','2024-01-01',5000.75,'ACTIVE',150.00),(1004,'PORTFOLIO_C','2024-01-01',15000.25,'ACTIVE',300.00),(1005,'PORTFOLIO_B','2024-01-01',35000.00,'ACTIVE',400.00),(1006,'PORTFOLIO_D','2024-01-01',7500.00,'ACTIVE',500.00);
-- Next: append a single-line CREATE ... diff_result SQL, then the two checks:
-- SELECT COUNT(*) total_rows, SUM(CASE WHEN _row_status = 0 THEN 1 ELSE 0 END) matching_rows, SUM(CASE WHEN _row_status > 0 THEN 1 ELSE 0 END) different_rows, SUM(CASE WHEN _row_status = 4 THEN 1 ELSE 0 END) missing_in_before, SUM(CASE WHEN _row_status = 5 THEN 1 ELSE 0 END) missing_in_after FROM diff_result;
-- SELECT * FROM diff_result WHERE _row_status > 0;

-- Optional cleanup after verification
DROP TABLE IF EXISTS diff_result;
DROP TABLE IF EXISTS after_table;
DROP TABLE IF EXISTS before_table;
